# GoRetro Internationalization (i18n)

## Overview
GoRetro now supports multiple languages with automatic detection based on browser settings, with the ability to manually switch languages. The selected language is persisted in both localStorage and cookies.

## Supported Languages
- **English (en)** - Default language
- **Polish (pl)** - Polish translation

## Features

### Automatic Language Detection
- The application automatically detects the browser's preferred language on first visit
- Falls back to English if the browser language is not supported
- Language preference is saved for future visits

### Manual Language Selection
- A language selector dropdown is available in the navigation bar
- Changes take effect immediately without page reload
- Selection is persisted across sessions

### Storage
Language preference is stored in:
1. **localStorage** - Primary storage method (key: `goretro_language`)
2. **Cookie** - Fallback method with 1-year expiration (key: `goretro_language`)

## File Structure

```
static/
├── i18n.js                    # Core i18n system
└── translations/
    ├── en.js                  # English translations
    └── pl.js                  # Polish translations
```

## How It Works

### 1. Translation Loading
Translation scripts are loaded in the HTML templates:
```html
<script src="/static/translations/en.js"></script>
<script src="/static/translations/pl.js"></script>
<script src="/static/i18n.js"></script>
```

### 2. Using Translations in HTML
Use `data-i18n` attributes for text content:
```html
<h2 data-i18n="index.createRoom.title">Create New Retrospective</h2>
```

For placeholder attributes:
```html
<input data-i18n="room.tickets.placeholder" placeholder="What's on your mind?">
```

For page title:
```html
<title data-i18n-title="index.pageTitle">GoRetro - Retrospective Tool</title>
```

### 3. Using Translations in JavaScript
```javascript
// Simple translation
const message = window.i18n.t('room.tickets.noTickets');

// Translation with parameters
const votesInfo = window.i18n.t('room.votes.info', { 
    used: 5, 
    total: 10 
});
// Result: "Votes used: 5 / 10"
```

### 4. Changing Language
```javascript
// Change to Polish
window.i18n.setLanguage('pl');

// Get current language
const currentLang = window.i18n.getCurrentLanguage();
```

### 5. Listening to Language Changes
```javascript
window.addEventListener('languageChanged', function(event) {
    const newLanguage = event.detail.language;
    // Re-render dynamic content
    renderAll();
});
```

## Adding a New Language

### Step 1: Create Translation File
Create a new file in `static/translations/`, e.g., `de.js` for German:

```javascript
window.translations = window.translations || {};

window.translations.de = {
    nav: {
        title: "GoRetro",
        user: "Benutzer"
    },
    // ... add all translation keys
};
```

### Step 2: Add Language to Supported List
Update `static/i18n.js`:
```javascript
const SUPPORTED_LANGUAGES = ['en', 'pl', 'de'];
```

### Step 3: Add to Language Selector
Update `templates/base.html`:
```html
<select id="language-selector" class="...">
    <option value="en">English</option>
    <option value="pl">Polski</option>
    <option value="de">Deutsch</option>
</select>
```

### Step 4: Load Translation Script
Add to HTML templates:
```html
<script src="/static/translations/de.js"></script>
```

## Translation Key Structure

Translations are organized hierarchically:

```javascript
{
    nav: {
        title: "...",
        user: "..."
    },
    index: {
        createRoom: {
            title: "...",
            roomNameLabel: "...",
            // ...
        },
        myRooms: { /* ... */ },
        howItWorks: { /* ... */ }
    },
    room: {
        phases: { /* ... */ },
        tickets: { /* ... */ },
        actions: { /* ... */ },
        participants: { /* ... */ },
        messages: { /* ... */ }
    },
    common: {
        cancel: "...",
        submit: "...",
        // ...
    }
}
```

## Parameter Replacement

Use curly braces for dynamic values:
```javascript
// Translation definition
"welcome": "Hello, {name}!"

// Usage
window.i18n.t('welcome', { name: 'John' })
// Result: "Hello, John!"
```

## Best Practices

1. **Keep keys descriptive**: Use nested keys that describe the context
   - Good: `room.tickets.addButton`
   - Bad: `btn1`

2. **Group related translations**: Organize by page/component

3. **Use parameters for dynamic content**: Don't concatenate strings

4. **Provide defaults**: Always include English as fallback

5. **Test all languages**: Verify translations in both languages

6. **Keep translations synchronized**: When adding new features, update all language files

## Troubleshooting

### Translations not appearing
1. Check browser console for errors
2. Verify translation key exists in the translation file
3. Ensure translation scripts are loaded before i18n.js

### Language not persisting
1. Check if localStorage is enabled in browser
2. Verify cookies are not blocked
3. Check browser console for storage errors

### New language not working
1. Verify language code is added to SUPPORTED_LANGUAGES
2. Check translation file is loaded in HTML
3. Ensure translation object is properly defined

## API Reference

### window.i18n.t(key, params)
Translate a key to current language
- **key**: Translation key (string)
- **params**: Optional object with parameter replacements
- **Returns**: Translated string

### window.i18n.setLanguage(lang)
Change current language
- **lang**: Language code (string)

### window.i18n.getCurrentLanguage()
Get current language code
- **Returns**: Language code (string)

### window.i18n.translatePage()
Re-translate all elements with data-i18n attributes

### window.i18n.initLanguageSelector()
Initialize language selector dropdown (called automatically)

## Events

### languageChanged
Fired when language is changed
```javascript
window.addEventListener('languageChanged', (event) => {
    console.log('Language changed to:', event.detail.language);
});
```
